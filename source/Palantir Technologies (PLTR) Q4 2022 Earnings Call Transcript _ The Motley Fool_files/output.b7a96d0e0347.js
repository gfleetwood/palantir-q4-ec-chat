;(function($,window,document,undefined){var pluginName="foolSearch",defaults={maxResults:10};function FoolSearch(element,options){this.element=element;this.$element=$(element);this.options=$.extend({},defaults,options);this.init();}
FoolSearch.prototype={init:function(){this.$resultsEl=$('<div class="ticker-input-results" role="list" aria-hidden="true"></div>');this.$resultsEl.hide();this.$resultsEl.insertAfter(this.element);this.keysBound=false;var _this=this;this.$resultsEl.on('mouseover','.ticker-input-results-result',function(e){_this.handleMouseOver.call(_this,e);});this.$resultsEl.on('click','.ticker-input-results-result',function(e){_this.submitEl($(e.target).closest('.ticker-input-results-result'))});$(this.element).on('focus',function(){if(!_this.keysBound){_this.attachKeyListeners.call(_this);_this.keysBound=true;}
if(!_this.resultsShowing()){$(_this.element).val('');}});$(this.element).on('blur',function(){_this.disposeKeyListeners.call(_this);_this.keysBound=false;});$(document).on('click',function(e){if($(e.target).closest('.ticker-input-results').length===0&&e.target!==_this.element){_this.hideResults();_this.disposeKeyListeners();}});this.premiumId=null;var page_type=window.location.pathname.match(/^(.*)\/((19|20)\d\d[\/.](0[1-9]|1[012])[\/.](0[1-9]|[12][0-9]|3[01]))\/(.*)$/);if(!page_type)
{var matches=window.location.pathname.match(/^(.*)\/(\d*)\/(.*)$/);if(matches&&matches[1]!=='/author'){this.premiumId=matches[2];}}},resultsShowing:function(){return this.$resultsEl.attr("aria-hidden")==="false";},attachKeyListeners:function(){var _this=this,$el=$(this.element);$el.on('propertychange input',function(){_this.handleInputChange.call(_this,$el.val());});$el.on('keydown',function(e){_this.handleKeyDown.call(_this,e)});},disposeKeyListeners:function(){var $el=$(this.element);$el.off('input');$el.off('keydown');},handleInputChange:function(q){if(q==""){this.hideResults();return;}
var _this=this;$.ajax({url:"https://api.fool.com/quotes/v4/instruments/search/",contentType:'application/json',dataType:"json",data:{maxResults:this.options.maxResults,apikey:"public",domain:"fool.com",query:q},success:function(response){if(response&&response.ResultsFound){_this.showResults(response.SearchResults);}else{_this.hideResults();}}});},handleKeyDown:function(e){switch(e.which){case 13:this.submit();break;case 27:this.hideResults();break;case 37:case 38:if(this.resultsShowing()){this.moveSelectionUp();}
break;case 39:case 40:if(this.resultsShowing()){this.moveSelectionDown();}
break;case 9:this.hideResults();return;default:return;}
e.preventDefault();},handleMouseOver:function(e){var $target=$(e.target);$target.siblings('.active').removeClass('active');$target.addClass('active');},moveSelectionUp:function(){var $activeEl=this.$resultsEl.find(".active");if($activeEl.length<=0){$activeEl=this.$resultsEl.find("div.ticker-input-results-result:last-child");$activeEl.addClass("active");return;}
var $prevEl=$activeEl.prev(".ticker-input-results-result");if($prevEl.length<=0){$prevEl=this.$resultsEl.find("div.ticker-input-results-result:last-child");}
$prevEl.addClass("active");$activeEl.removeClass("active");},moveSelectionDown:function(){var $activeEl=this.$resultsEl.find(".active");if($activeEl.length<=0){$activeEl=this.$resultsEl.find("div.ticker-input-results-result:first-child");$activeEl.addClass("active");return;}
var $nextEl=$activeEl.next(".ticker-input-results-result");if($nextEl.length<=0){$nextEl=this.$resultsEl.find("div.ticker-input-results-result:first-child");}
$nextEl.addClass("active");$activeEl.removeClass("active");},showResults:function(results){var items='';for(var i=0;i<results.length;i++){var r=results[i];items+='<div class="ticker-input-results-result'+(i===0?' active':'')+'" role="listitem" aria-valuetext="'+r.Name+'" aria-hidden="false" data-instrument-id='+r.InstrumentId+'>'+'<span class="ticker-input-results-symbol">'+r.Symbol+'</span>'+'<span class="ticker-input-results-company">'+r.Name+'</span>'+'<span class="ticker-input-results-exchange">'+r.Exchange+'</span>'+'<span class="exchange-icon exchange-'+r.Exchange+'"></span>'+'</div>';}
this.$resultsEl.html(items);this.$resultsEl.show();this.$resultsEl.attr("aria-hidden","false");},hideResults:function(){this.$resultsEl.hide();this.$resultsEl.attr("aria-hidden","true");this.$resultsEl.html('');},submit:function(){this.submitEl(this.$resultsEl.find(".active"));},submitEl:function(el){this.defaultAction(el,this);},defaultAction:function(el,search){if(el.length>0){var symbol=el.find(".ticker-input-results-symbol").text();var exchange=el.find(".ticker-input-results-exchange").text();var instrumentId=el.data('instrumentId');$(this.element).val(exchange+":"+symbol);var quoteUrl="https://www.fool.com/quote/";if(this.premiumId){quoteUrl+=this.premiumId+'/';}
window.location.href=quoteUrl+instrumentId;}else{return false;}}};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){var searchPlugin=new FoolSearch(this,options);if(options&&options.defaultAction){searchPlugin.defaultAction=options.defaultAction;}
$.data(this,"plugin_"+pluginName,searchPlugin);}});};})(jQuery,window,document);$(document).ready(function(){$('.ticker-input-input').foolSearch();});;